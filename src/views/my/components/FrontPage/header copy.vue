<template>
  <div class="userMess" v-if="userId">
    <!-- vip等级 -->
    <div class="messLeft" v-if="showVip" @click="$router.push('/vip-rule')">
      <image-load filePath="defi/组 249.png" class="userMessImg"></image-load>
      <p class="fw-num">v{{ userStore.userInfo.user?.level }}</p>
    </div>
    <svg-load name="userImg" class="userMessImg" v-else></svg-load>
    <div class="messRight">
      <Copy :data="userId">
        <template #copyMsg>
          <div class="rightTop fw-bold">UID：{{ userId }}</div>
        </template>
      </Copy>
      <!-- 信用分 -->
      <div class="rightBot">
        {{ _t18('credit_score') }}：{{ userStore.userInfo.detail?.credits }}
      </div>
    </div>
  </div>
  <!-- 钱包地址 -->
  <div class="copyName" v-if="address">
    <Copy :data="address">
      <template #copyMsg>
        <p>{{ _hideAddress(address) }}</p>
      </template>
    </Copy>
    <div class="list">
      <div class="item" v-for="item in listArray.filter((item) => item.isOpen)" :key="item.icon" @click="toView(item)">
        <image-load :filePath="item.logoUrl" alt="" class="itemImg" />
        <div class="itemRight">
          <!-- <div>{{ item.name }}</div> -->
          <div v-if="item.key == 'language'">{{ _t18(`language_key`) }}</div>
          <div v-else>{{ _t18(`sidebar_${item.key}`, ['bitmake', 'paxpay', 'aams']) }}</div>
          <div class="right_tip">
            <span v-if="item.key == 'primary' && userInfo.detail?.auditStatusPrimary === '1'">{{
              _t18('verified_ok')
              }}</span>
            <span v-if="item.key == 'advanced' && userInfo.detail?.auditStatusAdvanced === '1'">{{
              _t18('verified_ok')
              }}</span>
            <svg-load name="jiantou-y" class="rightImg"></svg-load>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>
<script setup>
// import { _t18 } from '@/utils/public'
import Copy from '@/components/common/Copy/index.vue'
import { useUserStore } from '@/store/user/index'
// import { useMainStore } from '@/store/index'
import { computed } from 'vue'
import { _hideAddress } from '@/utils/public'
import { noticeList, getWhitePaperUrl } from '@/api/common/index'
import { useMainStore } from '@/store/index.js'
// import { getCurrentInstance } from "vue";
import { _t18, _toView } from '@/utils/public'
// import { useUserStore } from '@/store/user/index'
import { storeToRefs } from 'pinia'
import { useToast } from '@/hook/useToast'
const { _toast } = useToast()

const userStore = useUserStore()
if (userStore.isSign) {
  userStore.getUserInfo()
}
// const vipClass = ref(0) //vip等级
// const userStore = useUserStore()
const mainStore = useMainStore()
const userId = computed(() => userStore.userInfo.user?.userId)
const address = computed(() => userStore.userInfo.user?.address)
const userAccount = computed(() => {
  let temp = userStore.userInfo.asset?.filter((item) => {
    return item.symbol == 'usdt' && item.type == 1
  })
  return temp[0]?.availableAmount || 0
})
const showVip = ref(mainStore.getVIPClass?.isOpen)
const vipClass = computed(() => {
  let temp = 0
  let start = ''
  let end = ''
  for (let key in mainStore.getVIPClass) {
    if (userAccount.value > mainStore.getVIPClass[key]) {
      start = key
    }
    if (userAccount.value <= mainStore.getVIPClass[key]) {
      end = key
      break
    }
  }
  if (start.replace('Start', '') === end.replace('End', '')) {
    temp = start.replace('Start', '').replace('vip', '')
  }
  return temp
})

// 用户信息
const { userInfo } = storeToRefs(userStore)
import { useRouter } from 'vue-router'
const router = useRouter()
// const _this = getCurrentInstance().appContext.config.globalProperties
// const mainStore = useMainStore()
// 获取侧边栏列表
// mainStore.setSidebarList()
const paperUrl = ref('')
const listArray = computed(() => {
  let data = mainStore.getSidebarList
  // for (let key in mainStore.getSidebarList) {
  //   if (mainStore.getSidebarList[key]) {
  //     let obj = {}
  //     // 初级认证,实名认证,绑定银行卡,设置资金密码,修改登录密码,邮箱认证,服务条款,白皮书,多语言
  //     if (key == 'primary') {
  //       // obj['name'] = _this.$t('sidebar_primary')
  //       obj['name'] = _t18('sidebar_primary')
  //       obj['path'] = '/certification-primary'
  //       obj['icon'] = 'chuji'
  //     }
  //     if (key == 'advanced') {
  //       obj['name'] = _t18('sidebar_advanced')
  //       obj['path'] = '/certification-advanced'
  //       obj['icon'] = 'gaoji'
  //     }
  //     if (key == 'bank') {
  //       obj['name'] = _t18('sidebar_bindCard')
  //       obj['path'] = '/bind-card'
  //       obj['icon'] = 'yinhangka'
  //     }
  //     if (key == 'tardPwd') {
  //       obj['name'] = _t18('sidebar_fundPwd')
  //       obj['path'] = '/fund-password'
  //       obj['icon'] = 'zhijinmm'
  //     }
  //     if (key == 'loginPwd') {
  //       obj['name'] = _t18('sidebar_loginPwd')
  //       obj['path'] = '/change-password'
  //       obj['icon'] = 'denglumm'
  //     }
  //     if (key == 'certified') {
  //       obj['name'] = _t18('sidebar_email')
  //       obj['path'] = '/email-authentication'
  //       obj['icon'] = 'youxiang'
  //     }
  //     if (key == 'termsService') {
  //       obj['name'] = _t18('sidebar_service')
  //       obj['path'] = '/term-service'
  //       obj['icon'] = 'fuwu'
  //     }
  //     if (key == 'paper') {
  //       obj['name'] = _t18('sidebar_paper')
  //       // obj['path'] = '/whitepaper'
  //       obj['type'] = 'link'
  //       obj['icon'] = 'baipishu'
  //     }
  //     if (key == 'language') {
  //       obj['name'] = _t18('language_key')
  //       obj['path'] = '/language-selection'
  //       obj['icon'] = 'yuyan'
  //     }
  //     data.push(obj)
  //   }
  // }
  return data
})
onMounted(() => {
  getWhitePaper()
})

/**
 * 获取白皮书URL
 */
/* const getWhitePaper = async () => {
  const res = await noticeList('WHITE_PAPER')
  if (res.code == '200' && res.data.length) {
    paperUrl.value = res.data[0]?.imgUrl || ''
  }
} */
const getWhitePaper = async () => {
  const res = await getWhitePaperUrl()
  if (res.code == '200') {
    paperUrl.value = res.data.url
  }
}
const toView = (item) => {
  if (item.jumpType == 'link' && (item.key == 'paper' || item.key == 'aboutUS')) {
    window.open(paperUrl.value)
  } else if (item.jumpType == 'path') {
    // _toView(item.jumpUrl)
    if (item.key == 'advanced') {
      /**
       * 在实名认证的时候 
        1. 先判断初级认证是否打开  如果是false  就不需要初级认证    直接放行
        2.如果初级认证是true  在判断用户的初级认证状态是否等于1  如果是1 放行
       * 
      */
      const target = listArray.value.find((item) => item.key == 'primary')
      // 判断是否经过初级认证
      if (target && target.isOpen) {
        const auditStatusPrimary = userInfo.value.detail.auditStatusPrimary
        if (auditStatusPrimary && auditStatusPrimary == 1) {
          router.push(item.jumpUrl)
        } else {
          _toast('please_primary')
        }
      } else {
        router.push(item.jumpUrl)
      }
    } else {
      router.push(item.jumpUrl)
    }
  }
}
</script>
<style lang="scss" scoped>
.userMess {
  padding: 20px 15px;
  display: flex;
  align-items: center;

  .userMessImg {
    width: 50px;
    height: 50px;
    border-radius: 50%;
  }

  .messRight {
    margin-left: 10px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    padding: 5px 0;

    .rightTop {
      font-size: 16px;
      color: var(--ex-default-font-color);
    }

    .rightBot {
      font-size: 14px;
      color: var(--ex-passive-font-color);
    }
  }
}

.copyName {
  margin: 0 15px;
  background-color: var(--ex-home-sidebar-address-bgcolor);
  font-size: 14px;
  border-radius: 3px;
  padding: 5px 10px;
  color: var(--ex-home-sidebar-address-ftcolor) !important;
}

.vipClass {
  font-size: 14px;
  color: var(--ex-passive-font-color);

  .senLeftImg {
    font-size: 20px;
    // margin-left: 15px;
    // margin-right: 10px;
  }
}

.messLeft {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  position: relative;

  p {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 18px;
    color: #333;
  }
}
.list {
  padding: 15px 15px;
  .item {
    padding: 15px 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    .itemImg {
      width: 20px;
      height: 20px;
      margin-right: 20px;
    }
    .itemRight {
      flex: 1;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: var(--ex-default-font-color);
      font-size: 14px;
      .rightImg {
        width: 6px;
        height: 10px;
      }
    }
  }
}
.right_tip {
  display: flex;
  align-items: center;
  span {
    // padding:3px 5px;
    margin-right: 10px;
    // border: 1px solid #17ac74;
    font-size: 12px;
    color: #17ac74;
  }
}
</style>
